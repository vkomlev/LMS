# Руководство для разработчиков (Contributing Guide)

## ⚠️ КРИТИЧЕСКИ ВАЖНО: Бизнес-логика в БД

**Перед добавлением любой бизнес-логики в код приложения:**

1. **ОБЯЗАТЕЛЬНО** прочитайте **[docs/database-triggers-contract.md](docs/database-triggers-contract.md)**
2. Проверьте, не реализована ли эта логика уже в БД через триггеры или ограничения
3. Если логика есть в БД → **НЕ ДУБЛИРУЙТЕ** её в коде приложения

### Что реализовано в БД:

- ✅ Автоматическая нумерация `order_number` в `user_courses`
- ✅ Пересчет `order_number` после удаления курса
- ✅ Валидация циклов в иерархии курсов
- ✅ Предотвращение самоссылок в зависимостях курсов

**Подробности:** см. [docs/database-triggers-contract.md](docs/database-triggers-contract.md)

---

## Правила разработки

### 1. Работа с базой данных

- Используйте миграции Alembic для всех изменений схемы БД
- Не изменяйте БД напрямую без миграций
- Тестируйте миграции на тестовой БД перед применением к production

### 2. Структура кода

- **Модели** (`app/models/`) - только структура данных, без бизнес-логики
- **Репозитории** (`app/repos/`) - доступ к данным, без бизнес-логики
- **Сервисы** (`app/services/`) - бизнес-логика (но НЕ та, что в БД!)
- **API** (`app/api/`) - эндпойнты, валидация запросов

### 3. Обработка ошибок

- Используйте `DomainError` для бизнес-ошибок
- Обрабатывайте `IntegrityError` от триггеров БД и преобразуйте в `DomainError`
- Всегда указывайте правильные HTTP статус-коды

### 4. Тестирование

- Пишите smoke-тесты для новых эндпойнтов
- Тестируйте поведение триггеров БД через интеграционные тесты
- Не мокируйте триггеры БД в тестах

### 5. Документация

- Обновляйте Swagger документацию для всех новых эндпойнтов
- Добавляйте примеры запросов и ответов
- Документируйте использование триггеров БД в комментариях кода
- При изменении API обновляйте соответствующую документацию в `docs/`:
  - Управление пользователями → `API_TEACHERS_MANAGEMENT.md`, `API_STUDENTS_MANAGEMENT.md`
  - Управление курсами → `courses-api.md`, `courses-import-manual.md`
  - Задания и проверка → `api-reference.md`, `api-examples.md`
  - Импорт задач → `import-api-documentation.md`, `import-quick-start.md`

---

## Процесс разработки

1. Создайте ветку от `main`
2. Реализуйте изменения
3. Обновите документацию (если нужно)
4. Напишите тесты
5. Проверьте, что не нарушаете контракт БД-триггеров
6. Создайте Pull Request

---

## Полезные ссылки

### Техническая документация

- [Контракт БД-триггеров](docs/database-triggers-contract.md) - ⚠️ ОБЯЗАТЕЛЬНО к прочтению перед разработкой
- [Миграции БД](app/db/migrations/)

### API Документация

#### Управление пользователями
- [API для управления преподавателями](docs/API_TEACHERS_MANAGEMENT.md)
- [API для управления студентами](docs/API_STUDENTS_MANAGEMENT.md)
- [API для связей преподаватель-курс](docs/API_TEACHER_COURSES.md)

#### Управление курсами
- [API курсов](docs/courses-api.md)
- [Руководство по импорту курсов](docs/courses-import-manual.md)

#### Задания и проверка
- [Полная документация API Quiz системы](docs/api-reference.md)
- [Примеры использования API Quiz системы](docs/api-examples.md)

#### Импорт задач
- [Быстрый старт - Импорт задач](docs/import-quick-start.md)
- [Документация API импорта задач](docs/import-api-documentation.md)
